trigger:
  - main

pr:
  - main

pool:
  name: Default   # self-hosted Windows agent

steps:
  - checkout: self
    submodules: true

  # Install Node.js
  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Setup Node.js'

  # Install dependencies
  - script: |
      npm ci
    displayName: 'Install dependencies'

  # Build the app
  - script: |
      npm run build
    displayName: 'Build application'

  # Azure CLI Login + Deploy Static Web App manually (NO DOCKER)
  - task: AzureCLI@2
    inputs:
      azureSubscription: "Azure-Service-Connection"
      scriptType: "bash"
      scriptLocation: "inlineScript"
      inlineScript: |
        echo "Uploading to Azure Static Web App..."

        az staticwebapp upload \
          --name localShopWebApp \
          --resource-group localShopRG \
          --source build

    displayName: "Deploy Static Web App"
