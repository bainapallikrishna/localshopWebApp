trigger:
- main

pr:
- main

# ✔ Use Linux agent (required for Static Web Apps)
pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self

# Install Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'Setup Node.js'

# Install dependencies
- script: npm ci
  workingDirectory: '$(Build.SourcesDirectory)'
  displayName: 'Install npm packages'

# Build React App
- script: npm run build
  workingDirectory: '$(Build.SourcesDirectory)'
  displayName: 'Build React app'

# ✔ Deploy to Azure Static Web Apps (official task)
- task: AzureStaticWebApp@0
  inputs:
    # ✔ You MUST create this variable in Azure DevOps Library:
    # Name: deployment_token
    azure_static_web_apps_api_token: $(deployment_token)

    # Path of React app root
    app_location: "/"

    # React build output folder
    output_location: "build"

  displayName: "Deploy to Azure Static Web Apps"
