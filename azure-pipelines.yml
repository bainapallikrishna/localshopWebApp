trigger:
- main

pr:
- main

# ✔ Must use Linux agent
pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self

# Install Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'Setup Node.js'

# Install dependencies
- script: npm ci
  workingDirectory: '$(Build.SourcesDirectory)'
  displayName: 'Install npm packages'

# Build React app
- script: npm run build
  workingDirectory: '$(Build.SourcesDirectory)'
  displayName: 'Build React app'

# ✔ Official working SWA deploy task
- task: AzureStaticWebApp@0
  inputs:
    # ✔ Create "deployment_token" in Azure DevOps Library
    azure_static_web_apps_api_token: $(deployment_token)

    # ✔ Root folder of React app
    app_location: "/"

    # ✔ Build output folder
    output_location: "build"

  displayName: "Deploy to Azure Static Web Apps"
